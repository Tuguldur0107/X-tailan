Мэдээж андаа, дараах нь **developer.itc.gov.mn** сайтад байрлаж буй eTax API-г ашиглан X-SENDER төслийг Puppeteer-гүйгээр бүрэн автоматжуулах боломжийн **монгол хэл дээрх тайлан** юм:

---

# eTax системтэй API-р холбогдох боломжуудын тайлан (developer.itc.gov.mn)

## 1. eTax системд зориулсан API-ууд байгаа эсэх

**Тийм – Татварын ерөнхий газар нь eTax системд зориулсан албан ёсны API-уудыг** хөгжүүлэгчдэд зориулан гаргасан. Эдгээр API нь дараах үндсэн боломжуудыг олгодог:

* **Нэвтрэх (Authentication):** auth.itc.gov.mn SSO (Нэгдсэн нэвтрэх систем)-ээр дамжин access token (JWT) авч хэрэглэнэ.
* **Компанийн жагсаалт авах:** тухайн хэрэглэгчийн хамааралтай ААН-уудын мэдээллийг авах `/api/user/getUserOrgs` endpoint байна.
* **Тайлангийн жагсаалт авах:** тухайн компанид ямар тайлан илгээх шаардлагатай байгааг авах API бий.
* **Тайлан илгээх (submit):** тайлан (үүнд X тайлан ч орно) API-р дамжуулан илгээх боломжтой.
* **Тайлангийн статус шалгах:** илгээсэн тайлан амжилттай бүртгэгдсэн эсэхийг шалгах боломжтой.

## 2. API хэрхэн ажилладаг вэ (authentication, өгөгдөл, хариу)

API ашиглах дараалал:

1. **Токен авах:** Хэрэглэгчийн etax нэр, нууц үгийг `auth.itc.gov.mn` дээр илгээж access token авна.
2. **Компанийн ID авах:** `GET /api/user/getUserOrgs` endpoint-оор тухайн хэрэглэгчийн компаниудын `ent_id` утгыг авна.
3. **Илгээх ёстой тайлангийн жагсаалт авах:** Татварын хэлбэр, хугацаа зэргийг энэ API-с авна.
4. **X тайлан бэлтгэх:** Илгээх payload дотор `isZeroReport: true` гэсэн утга оруулбал X тайлан гэж ойлгоно.
5. **Тайлан илгээх:** `POST /api/return/submit` маягийн endpoint-руу тайлангийн мэдээллийг илгээх.
6. **Хариу авах:** API амжилттай бол `SUCCESS`, алдаатай бол `ERROR` гэсэн хариу буцаана.
7. **Статус шалгах (шаардлагатай бол):** дахин тайлангийн жагсаалтыг аваад тухайн тайлан жагсаалтад байхгүй болсон бол амжилттай илгээгдсэн гэж үзнэ.

## 3. X тайланг API-р илгээх боломж

**Тийм.** API ашиглан X тайлан (орлого байхгүй тайлан) илгээж болно. Үүнийг тусгай endpoint-оор биш, харин тайлан илгээх payload дотор **“X тайлан” гэдгийг заасан flag** (`isZeroReport: true` гэх мэт) оруулснаар гүйцэтгэнэ.

Жишээ:

```json
{
  "ent_id": "123456",
  "formNo": 1100,
  "period": "2025-07",
  "isZeroReport": true
}
```

## 4. API ашиглахад ямар эрх хэрэгтэй вэ

* **Тийм ээ, хэрэглэгчийн etax нэр, нууц үг шаардлагатай.**
* Хэрэглэгч тухайн ААН-ийн өмнөөс тайлан илгээх эрхтэй байх ёстой.
* Нэмэлтээр API ашиглах зөвшөөрөл (sandbox access гэх мэт) авах шаардлагатай байж магадгүй.
* Татварын байгууллагын Keycloak системээр токен авна.

## 5. Хөгжүүлэгчдэд зориулсан материал байгаа эсэх

* [developer.itc.gov.mn](https://developer.itc.gov.mn) сайтад eTax API-ийн техникийн баримт бичиг байрласан.
* “Цахим тайлангийн системийн вэб сервисийн холболтын гарын авлага” PDF файлд:

  * Нэвтрэх бүтэц
  * API замууд
  * Payload жишээ
  * Тайлан илгээх параметрүүд
  * formNo, ent\_id, period зэрэг шаардлагатай талбаруудыг тайлбарласан байдаг.

## 6. API ашиглах боломжгүй тохиолдолд workaround

Хэрэв ямар нэгэн шалтгаанаар API ашиглах боломжгүй бол дараах **гибрид** хувилбар санал болгоно:

* **API ашиглан токен авч Puppeteer-т ашиглах:** CAPTCHA алгасахын тулд token ашиглан UI-д шууд login хийх боломжтой.
* **API ашиглан компанийн жагсаалт, тайлангийн жагсаалтыг авах:** UI automation-г илүү найдвартай болгоно.
* **UI automation зөвхөн тайлан илгээх хэсэгт ашиглах:** өөр бүх өгөгдөл API-гаар авбал хурдан болно.
* **Puppeteer-г зөвхөн fallback байдлаар ашиглах:** үндсэн логик API-р явж, зөвхөн алдаа гарсан үед Puppeteer ашиглах.

---

Хэрвээ та хүсвэл дараагийн алхамд:

* API token авах demo код
* Тайлан илгээх JSON payload жишээ
* developer.itc.gov.mn сайтад бүртгүүлэх заавар

гэх мэт нэмэлт техникийн тусламжийг бэлдэж өгье. Хэлээрэй, андаа.
